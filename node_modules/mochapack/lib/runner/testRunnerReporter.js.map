{"version":3,"sources":["../../src/runner/testRunnerReporter.js"],"names":["testRunnerReporter","log","console","formatTitleInfo","title","chalk","inverse","formatTitleWarn","black","bgYellow","formatTitleError","white","bold","bgRed","Reporter","options","onUncaughtException","err","stack","onLoadingException","onWebpackStart","clearTerminal","added","length","logInfo","map","f","join","removed","onWebpackReady","stats","formatStats","errors","warnings","startTime","endTime","compileTime","green","displayErrors","onMochaStart","onMochaAbort","onMochaReady","failures","red","onEntryAdded","file","push","onEntryRemoved","cwd","eventEmitter","on","quiet","interactive","process","stdout","write","platform","severity","errorCount","message","yellow","titleColor","forEach"],"mappings":"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","file":"testRunnerReporter.js","sourcesContent":["// @flow\nimport EventEmitter from 'events';\nimport chalk from 'chalk';\nimport type { Stats } from '../webpack/types';\nimport createStatsFormatter from '../webpack/util/createStatsFormatter';\n\ntype ReporterOptions = {\n  eventEmitter: EventEmitter,\n  interactive: boolean,\n  clearTerminal: boolean,\n  quiet: boolean,\n  cwd: string,\n};\n\nconst log = (...args: Array<any>) => {\n  console.log(...args); // eslint-disable-line no-console\n  console.log();// eslint-disable-line no-console\n};\n\nconst formatTitleInfo = (title) => chalk.inverse('', title, '');\nconst formatTitleWarn = (title) => chalk.black.bgYellow('', title, '');\nconst formatTitleError = (title) => chalk.white.bold.bgRed('', title, '');\n\nclass Reporter {\n  added: Array<string>;\n  removed: Array<string>;\n  options: ReporterOptions;\n  formatStats: (stats: Stats) => { warnings: Array<string>, errors: Array<string> };\n\n  constructor(options: ReporterOptions) {\n    const { cwd, eventEmitter } = options;\n\n    this.options = options;\n    this.added = [];\n    this.removed = [];\n    this.formatStats = createStatsFormatter(cwd);\n\n    eventEmitter.on('uncaughtException', this.onUncaughtException);\n    eventEmitter.on('exception', this.onLoadingException);\n    eventEmitter.on('webpack:start', this.onWebpackStart);\n    eventEmitter.on('webpack:ready', this.onWebpackReady);\n    eventEmitter.on('mocha:begin', this.onMochaStart);\n    eventEmitter.on('mocha:aborted', this.onMochaAbort);\n    eventEmitter.on('mocha:finished', this.onMochaReady);\n    eventEmitter.on('entry:added', this.onEntryAdded);\n    eventEmitter.on('entry:removed', this.onEntryRemoved);\n  }\n\n  logInfo(...args: Array<any>) {\n    if (!this.options.quiet) {\n      log(...args);\n    }\n  }\n\n  clearTerminal() {\n    if (this.options.clearTerminal && this.options.interactive) {\n      process.stdout.write(process.platform === 'win32' ? '\\x1B[2J\\x1B[0f' : '\\x1B[2J\\x1B[3J\\x1B[H');\n    }\n  }\n\n  static displayErrors(severity: string, errors: Array<any>) {\n    const errorCount = errors.length;\n\n    const message = severity === 'error' ?\n      `Failed to compile with ${chalk.red(`${errorCount} ${severity}(s)`)}` :\n      `Compiled with ${chalk.yellow(`${errorCount} ${severity}(s)`)}`;\n\n    const titleColor = severity === 'error' ? formatTitleError : formatTitleWarn;\n    log(titleColor('WEBPACK'), message);\n    errors.forEach((err) => log(err));\n  }\n\n  onUncaughtException = (err: Error) => {\n    log(formatTitleError('UNCAUGHT EXCEPTION'), 'Exception occurred after running tests');\n    log(err.stack);\n  };\n\n  onLoadingException = (err: Error) => {\n    log(formatTitleError('RUNTIME EXCEPTION'), 'Exception occurred while loading your tests');\n    log(err.stack);\n  };\n\n  onWebpackStart = () => {\n    this.clearTerminal();\n    if (this.added.length > 0) {\n      this.logInfo(formatTitleInfo('MOCHA'), 'The following test entry files were added:');\n      this.logInfo(this.added.map((f) => `+ ${f}`).join('\\n'));\n    }\n\n    if (this.removed.length > 0) {\n      this.logInfo(formatTitleInfo('MOCHA'), 'The following test entry files were removed:');\n      this.logInfo(this.removed.map((f) => `- ${f}`).join('\\n'));\n    }\n\n    this.logInfo(formatTitleInfo('WEBPACK'), 'Compiling...');\n\n    this.added.length = 0;\n    this.removed.length = 0;\n  };\n\n  onWebpackReady = (err?: Error, stats?: Stats) => {\n    this.clearTerminal();\n    if (stats != null) {\n      const { errors, warnings } = this.formatStats(stats);\n\n      if (errors.length === 0 && warnings.length === 0) {\n        const { startTime, endTime } = stats;\n        const compileTime = endTime - startTime;\n        this.logInfo(formatTitleInfo('WEBPACK'), `Compiled successfully in ${chalk.green(`${compileTime}ms`)}`);\n        return;\n      }\n\n      if (errors.length > 0) {\n        Reporter.displayErrors('error', errors);\n        return;\n      }\n\n      if (warnings.length > 0) {\n        Reporter.displayErrors('warning', warnings);\n      }\n    } else {\n      Reporter.displayErrors('error', [err]);\n    }\n  };\n\n  onMochaStart = () => {\n    this.logInfo(formatTitleInfo('MOCHA'), 'Testing...');\n  };\n\n  onMochaAbort = () => {\n    this.logInfo(formatTitleInfo('MOCHA'), 'Tests aborted');\n  };\n\n  onMochaReady = (failures: number) => {\n    if (failures === 0) {\n      this.logInfo(formatTitleInfo('MOCHA'), `Tests completed ${chalk.green('successfully')}`);\n    } else {\n      this.logInfo(formatTitleInfo('MOCHA'), `Tests completed with ${chalk.red(`${failures} failure(s)`)}`);\n    }\n  };\n\n  onEntryAdded = (file: string) => {\n    this.added.push(file);\n  };\n\n  onEntryRemoved = (file: string) => {\n    this.removed.push(file);\n  };\n}\n\nexport default function testRunnerReporter(options: ReporterOptions) {\n  new Reporter(options); // eslint-disable-line no-new\n}\n"]}