{"version":3,"sources":["../../../src/webpack/util/createStatsFormatter.js"],"names":["createStatsFormatter","createGetFile","requestShortener","e","file","module","readableIdentifier","ensureWebpackErrors","errors","map","message","prependWarning","chalk","yellow","prependError","red","rootPath","RequestShortener","getFile","formatError","err","lines","push","underline","join","EOL","statsFormatter","stats","compilation","warnings"],"mappings":";;;;;kBAkCwBA,oB;;AAjCxB;;AACA;;;;AACA;;;;AACA;;;;AAGA,IAAMC,gBAAgB,SAAhBA,aAAgB,CAACC,gBAAD;AAAA,SAAwC,UAACC,CAAD,EAA8B;AAC1F;AACA,QAAIA,EAAEC,IAAN,EAAY;AACV;AACA,aAAOD,EAAEC,IAAT;AACD,KAHD,MAGO,IAAID,EAAEE,MAAF,IAAYF,EAAEE,MAAF,CAASC,kBAArB,IAA2C,OAAOH,EAAEE,MAAF,CAASC,kBAAhB,KAAuC,UAAtF,EAAkG;AACvG;AACA,aAAO,qCAAoBH,EAAEE,MAAF,CAASC,kBAAT,CAA4BJ,gBAA5B,CAApB,CAAP;AACD;AACD;AACA,WAAO,IAAP;AACD,GAXqB;AAAA,CAAtB;;AAaA;AACA,IAAMK,sBAAsB,SAAtBA,mBAAsB,CAACC,MAAD;AAAA,SAA+DA,OACxFC,GADwF,CACpF,UAACN,CAAD,EAA8B;AACjC;AACA,QAAI,OAAOA,CAAP,KAAa,QAAjB,EAA2B;AACzB;AACA,aAAS,EAAEO,SAASP,CAAX,EAAT;AACD;AACD,WAAOA,CAAP;AACD,GARwF,CAA/D;AAAA,CAA5B;;AAUA,IAAMQ,iBAAiB,SAAjBA,cAAiB,CAACD,OAAD;AAAA,SAAwBE,gBAAMC,MAAN,CAAa,SAAb,CAAxB,SAAmDH,OAAnD;AAAA,CAAvB;AACA,IAAMI,eAAe,SAAfA,YAAe,CAACJ,OAAD;AAAA,SAAwBE,gBAAMG,GAAN,CAAU,OAAV,CAAxB,SAA8CL,OAA9C;AAAA,CAArB;;AAEe,SAASV,oBAAT,CAA8BgB,QAA9B,EAAgD;AAC7D,MAAMd,mBAAmB,IAAIe,0BAAJ,CAAqBD,QAArB,CAAzB;AACA,MAAME,UAAUjB,cAAcC,gBAAd,CAAhB;;AAEA,MAAMiB,cAAc,SAAdA,WAAc,CAACC,GAAD,EAAuB;AACzC,QAAMC,QAAuB,EAA7B;;AAEA,QAAMjB,OAAOc,QAAQE,GAAR,CAAb;;AAEA;AACA,QAAIhB,QAAQ,IAAZ,EAAkB;AAChBiB,YAAMC,IAAN,SAAiBV,gBAAMW,SAAN,CAAgBnB,IAAhB,CAAjB;AACAiB,YAAMC,IAAN,CAAW,EAAX;AACD,KAHD,MAGO;AACL;AACA;AACA;AACA;AACA;AACAD,YAAMC,IAAN,CAAW,EAAX;AACAD,YAAMC,IAAN,CAAW,EAAX;AACD;;AAEDD,UAAMC,IAAN,CAAW,oCAAmBF,IAAIV,OAAvB,CAAX;;AAEA,WAAOW,MAAMG,IAAN,CAAWC,OAAX,CAAP;AACD,GAtBD;;AAwBA,SAAO,SAASC,cAAT,CAAwBC,KAAxB,EAAsC;AAAA,QACnCC,WADmC,GACnBD,KADmB,CACnCC,WADmC;;;AAG3C,WAAO;AACLpB,cAAQD,oBAAoBqB,YAAYpB,MAAhC,EAAwCC,GAAxC,CAA4CU,WAA5C,EAAyDV,GAAzD,CAA6DK,YAA7D,CADH;AAELe,gBAAUtB,oBAAoBqB,YAAYC,QAAhC,EAA0CpB,GAA1C,CAA8CU,WAA9C,EAA2DV,GAA3D,CAA+DE,cAA/D;AAFL,KAAP;AAID,GAPD;AAQD","file":"createStatsFormatter.js","sourcesContent":["// @flow\nimport { EOL } from 'os';\nimport chalk from 'chalk';\nimport RequestShortener from 'webpack/lib/RequestShortener';\nimport { formatErrorMessage, stripLoaderFromPath } from './formatUtil';\nimport type { WebpackError, Stats } from '../types';\n\nconst createGetFile = (requestShortener: RequestShortener) => (e: WebpackError): ?string => {\n  /* istanbul ignore if */\n  if (e.file) {\n    // webpack does this also, so there must be case when this happens\n    return e.file;\n  } else if (e.module && e.module.readableIdentifier && typeof e.module.readableIdentifier === 'function') {\n    // if we got a module, build a file path to the module without loader information\n    return stripLoaderFromPath(e.module.readableIdentifier(requestShortener));\n  }\n  /* istanbul ignore next */\n  return null;\n};\n\n// helper to transform strings in errors\nconst ensureWebpackErrors = (errors: Array<string | WebpackError>): Array<WebpackError> => errors\n  .map((e: string | WebpackError) => {\n    /* istanbul ignore if */\n    if (typeof e === 'string') {\n      // webpack does this also, so there must be case when this happens\n      return (({ message: e }: any): WebpackError);\n    }\n    return e;\n  });\n\nconst prependWarning = (message: string) => `${chalk.yellow('Warning')} ${message}`;\nconst prependError = (message: string) => `${chalk.red('Error')} ${message}`;\n\nexport default function createStatsFormatter(rootPath: string) {\n  const requestShortener = new RequestShortener(rootPath);\n  const getFile = createGetFile(requestShortener);\n\n  const formatError = (err: WebpackError) => {\n    const lines: Array<string> = [];\n\n    const file = getFile(err);\n\n    /* istanbul ignore else */\n    if (file != null) {\n      lines.push(`in ${chalk.underline(file)}`);\n      lines.push('');\n    } else {\n      // got no file, that happens only for more generic errors like the following from node-sass\n      //    Missing binding /mochapack-example/node_modules/node-sass/vendor/linux-x64-48/binding.node\n      //    Node Sass could not find a binding for your current environment: Linux 64-bit with Node.js 6.x\n      //    ...\n      // just print 2 lines like file\n      lines.push('');\n      lines.push('');\n    }\n\n    lines.push(formatErrorMessage(err.message));\n\n    return lines.join(EOL);\n  };\n\n  return function statsFormatter(stats: Stats) {\n    const { compilation } = stats;\n\n    return {\n      errors: ensureWebpackErrors(compilation.errors).map(formatError).map(prependError),\n      warnings: ensureWebpackErrors(compilation.warnings).map(formatError).map(prependWarning),\n    };\n  };\n}\n"]}